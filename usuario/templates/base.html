{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}{% endblock %}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="{% static 'estilos.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body>
   {% block navbar %}
  <nav class="navbar bg-primary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand text-white"  href="{% url 'dashboard' %}">
      <img src="{% static 'usuario/img/logoBlanco.png' %}" alt="UTN-FRCU" style="height: 40px;">
      </a>
       <div class="d-flex ms-auto">
        {% if request.user.is_authenticated %}
        <span class="navbar-text text-white">
          Hola {{ request.user.first_name|default:request.user.username }}
          <form action="{% url 'logout' %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-success btn-sm ms-2"
                    style="background-color: #f8f9fa; color: #28a745; border-color: #28a745;"
                    onmouseover="this.style.backgroundColor='#28a745'; this.style.color='#ffffff';"
                    onmouseout="this.style.backgroundColor='#f8f9fa'; this.style.color='#154360';">Cerrar sesión
           </button>
          </form>
        </span>
        {% else %}
        <div class="navbar-nav">
          <a class="nav-link text-white" href="{% url 'login' %}">Iniciar sesión</a>
        </div>
        {% endif %}
      </div>
    </div>
</nav>

 {% endblock navbar %}

  {% if messages %}
      {% for message in messages %}
        <div class="alert alert-primary" role="alert">
          {{ message|safe }}
        </div>
      {% endfor %}
  {% endif %}
  <div class="container mt-3">
    {% block content %}
    {% endblock %}
  </div>

  {# Carga de JavaScript de Bootstrap #}
<script>
   function loadContent(url, title) {
            fetch(url, {
                headers: {
                    'X-Requested-With': 'XMLHttpRequest' // Añade esta cabecera para que Django detecte la petición AJAX
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(html => {
                // Limpia el contenido actual y lo reemplaza con el HTML cargado
                dynamicContentDiv.innerHTML = html;
                mainContentTitle.innerText = title;

                // Después de inyectar el HTML, buscar y ejecutar cualquier script inyectado.
                // Esta es la parte crucial para que los gráficos funcionen.
                const scripts = dynamicContentDiv.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    // Eliminar el script viejo antes de añadir el nuevo para evitar duplicados
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                    dynamicContentDiv.appendChild(newScript);
                });


                // Después de cargar el contenido, si hay botones de reporte, inicialízalos.
                // Esta función se necesita si el contenido inyectado incluye esos botones.
                initializeReportCardClicks();

            })
            .catch(error => {
                console.error('Error al cargar el contenido:', error);
                dynamicContentDiv.innerHTML = '<div class="alert alert-danger" role="alert">Error al cargar el contenido. Por favor, inténtalo de nuevo.</div>';
            });
        }
</script>
  {# Aquí es donde se inyectará tu JavaScript adicional del dashboard.html #}

        {% block extra_js %}
        {% endblock %}



</body>
</html>